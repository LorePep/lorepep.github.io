<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Effective strategies for classification in CT scans &middot; </title>
        <meta name="description" content="Some proven strategies and thoughts to deal with classification of CT scans.">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.63.2" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Effective strategies for classification in CT scans">
<meta property="og:description" content="Some proven strategies and thoughts to deal with classification of CT scans.">
<meta property="og:type" content="article">
<meta property="og:url" content="/dicomscans/">
        <link rel="stylesheet" href="/dist/styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
        
        
    </head>
    <body>
        

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Lorenzo Peppoloni" href="/">Lorenzo Peppoloni</a>
                            </h1>
                        
                        <a class="button-square" href="/index.xml"><i class="fa fa-rss"></i></a>
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/lorepep" rel="me">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/lorepep" rel="me">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://twitter.com/lpeppoloni" rel="me">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="About" href="/page/about/">About</a>
    </li>

    <li class="site-nav-item">
        <a title="CV" href="">CV</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Effective strategies for classification in CT scans</h1>
    
        <p class="post-description" itemprop="description">Some proven strategies and thoughts to deal with classification of CT scans.</p>
    
    <p class="post-date post-line">
        <span>Published <time datetime="2020-03-02" itemprop="datePublished">Mon, Mar 2, 2020</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="#" itemprop="url" rel="author">Lorenzo Peppoloni</a>
            </span>
        </span>
    </p>
    
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>Last october I took part to the <a href="https://www.kaggle.com/c/rsna-intracranial-hemorrhage-detection">RSNA Intracranial Hemorrage Detection</a> Kaggle challenge. I ended up in the top 10%, which considering my full-time job and travelling (at the time), was a placement I am quite happy with.</p>

<p>The goal of this post is to share some ideas and strategies to work with classifiation from DICOM images.</p>

<h2 id="the-task">The task</h2>

<p>The task in this competition was to tackle a multiclass classification problem, with the goal of classifying 5 different types of brain hemorrage (+ non present) from computerized tomography (CT) scans of patient's heads. Each type of hemorrage tends to appear in different location of the head with different features. A summary with examples is reported below.</p>

<p><figure><img src="/dicom/hemorrage.png" alt="hemorrages"></figure></p>

<p>CT scans usually are slices on the axial plane taken at different heights. This means that you can combine consecutive scans to obtain 3D information. In general scans are provided in the <strong>DICOM</strong> format, which is an international standard for digital medical images. Prior to this format. DICOM files represents pixel intensities in normal units (they can range for example between -32768 and 32767 or less according to the number of bits used).</p>

<h2 id="scans">Scans</h2>

<p>First you can convert the scans from pixel intensitied to Hunsfeld Units (HU). Hunsfeld Units describe a linear scale of radiointensity. Basically values range between -1000 (radiointensity of air) and 1000 roughly metal. Harder materials (such as bone or metal) will have a higher radiointensity. Lighter materials, like flesh, soft tissue or water, will have a lower radiointensity.</p>

<p>To convert from the DICOM to HU you usually have to look for &quot;slope&quot; and &quot;intercept&quot; in the file metadata. The two values, which are usually provided by the manufactorer allows you to get the HU:</p>

<p><span  class="math">\[ \text{scan}_{HU} = \text{scan} * \text{slope} + \text{intercept} \]</span></p>

<p>Now if you try and visualize the images in HU you will probably see something like this</p>

<p><figure><img src="/dicom/hunsfeld.png" alt="hunsfeld_example"></figure></p>

<p>So what's the problem?</p>

<p>The problem is that in a normal grayscale image you can represent 256 different shades, this means that, being the HU roughly 2000 values, you have 8 values per shade of grey. As a human you cannot visually  detect changes in shades that are less than 120 HU (in gray scale). That's why you don't see the nice head scan that we were expecting, but instead you just see a grey blob.</p>

<p>So what do doctors do?</p>

<p>During scan assessment by a human doctor, what is actually done is that each scan is &quot;focused&quot; on a particular range, giving information about a certain type of tissue. Doctors usually focus on 2-3 different windows at the same time (according to the assessment they are performing).</p>

<p>In the case of brain hemmorages, there are 5 important windows, each one focusing on a type of tissue:</p>

<ol>
<li><em>Brain Matter window</em>: W:80 L:40</li>
<li><em>Blood/subdural window</em>: W:130-300 L:50-100</li>
<li><em>Soft tissue window</em>: W:350–400 L:20–60</li>
<li><em>Bone window</em>: W:2800 L:600</li>
<li><em>Grey-white differentiation window</em>: W:8 L:32 or W:40 L:40</li>
</ol>

<p>The windows are expressed with two numbers <code>W</code> the width of the window and <code>L</code> the center. Each window focuses on the range:</p>

<p><span  class="math">\[ L - W / 2 < \text{HU} < L + W / 2 \]</span></p>

<h2 id="mimic-doctors-with-ml">Mimic doctors with ML</h2>

<p>A viable approach is to choose 3 different windows and use them as the channels of a 3-channel image. In this way our network will try and learn, as a human doctor does, to classify hemorrage using multiple windows of the same scan.</p>

<p>This approach works and was successfully used during the competition (including me). The approach is also backed up by several research papers.</p>

<p>An example of the images one obtains, are shown in the pictures.</p>

<h2 id="introduce-the-time-component">Introduce the time component</h2>

<p>Another approach, that was quite successful in the competition was to introduce a time component instead of multiple windows.</p>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/computer-vision/">computer-vision</a>, 
            
                <a href="/tags/machine-learning/">machine-learning</a>, 
            
                <a href="/tags/deep-learning/">deep-learning</a>
            
        </p>
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?text=Effective%20strategies%20for%20classification%20in%20CT%20scans&url=%2fdicomscans%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=%2fdicomscans%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        

        
            <a class="icon-google-plus" href="https://plus.google.com/share?url=%2fdicomscans%2f"
              onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
              <i class="fa fa-google-plus"></i>
                <span class="hidden">Google+</span>
            </a>
        
        
            <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&title=Effective%20strategies%20for%20classification%20in%20CT%20scans&url=%2fdicomscans%2f&summary=Some%20proven%20strategies%20and%20thoughts%20to%20deal%20with%20classification%20of%20CT%20scans."
               onclick="window.open(this.href, 'linkedin-share', 'width=554,height=481');return false;">
               <i class="fa fa-linkedin"></i>
               <span class="hidden">LinkedIn</span>
            </a>
        
    </div>
</footer>

        
    </article>
</div>

</div>
</div>

<footer class="footer">
    <div class="container">
        <div class="site-title-wrapper">
            <h1 class="site-title">
                <a title="Lorenzo Peppoloni" href="/">Lorenzo Peppoloni</a>
            </h1>
            <a class="button-square button-jump-top js-jump-top" href="#">
                <i class="fa fa-angle-up"></i>
            </a>
        </div>

        <p class="footer-copyright">
            <span>&copy; 2020 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
        </p>
        <p class="footer-copyright">
            <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
            <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
        </p>
    </div>
</footer>

<script src="/js/jquery-1.11.3.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>


<script src="/js/scripts.js"></script>
</body>
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</html>

